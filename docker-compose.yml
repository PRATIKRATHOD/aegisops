services:
  # -------------------------
  # 1) Python Agent Core
  # -------------------------
  agent-core:
    build:
      context: ./agent-core
      dockerfile: Dockerfile
    container_name: aegisops-agent-core
    environment:
      - PYTHONUNBUFFERED=1
      - OLLAMA_URL=http://host.docker.internal:11434
    volumes:
      - ./backend/src/main/resources/data:/backend/src/main/resources/data
    depends_on:
      - backend
    networks:
      - aegisops-net

  # -------------------------
  # 2) Spring Boot Backend
  # -------------------------
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: aegisops-backend
    ports:
      - "8080:8080"
    volumes:
      - ./backend/src/main/resources/data:/backend/src/main/resources/data
    networks:
      - aegisops-net

  # -------------------------
  # 3) React UI (Nginx)
  # -------------------------git 
  ui:
    build:
      context: ./ui
      dockerfile: Dockerfile
    container_name: aegisops-ui
    ports:
      - "5173:80"      # Serve UI at localhost:5173
    depends_on:
      - backend
    networks:
      - aegisops-net

# -------------------------
# Shared network
# -------------------------
networks:
  aegisops-net:
    driver: bridge
